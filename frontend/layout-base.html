<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Controle de Acesso</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <!-- Design System CSS -->
    <link rel="stylesheet" href="/assets/css/app.css">
    <link rel="stylesheet" href="/assets/css/themes/theme-blue.css">

</head>

<body>

    <!-- Base Scripts (Head) -->
    <script src="js/auth-guard.js"></script>
    <script src="js/session-manager-core.js"></script>
    </head>

    <body>
        <button class="menu-toggle" onclick="toggleMenu()">
            <i class="fas fa-bars"></i>
        </button>

        <nav class="sidebar" id="sidebar">
            <!-- Sidebar loaded dynamically by sidebar-controller.js -->
        </nav>

        <main class="main-content">
            <header class="header">
                <h1 id="pageTitle"><i class="fas fa-circle"></i> Carregando...</h1>
                <div class="user-mini-profile">
                    <div class="user-info-mini">
                        <span class="header-user-name">Carregando...</span>
                    </div>
                    <div class="user-avatar">A</div>
                </div>
            </header>

            <!-- Dynamic Content Container -->
            <div id="appContent">
                <div class="loading" style="display:block; text-align:center; padding: 3rem;">
                    <i class="fas fa-spinner fa-spin fa-2x" style="color:var(--color-primary-600)"></i>
                    <p style="margin-top:1rem; color:var(--color-text-tertiary)">Inicializando aplicação...</p>
                </div>
            </div>
        </main>

        <!-- Base Scripts (Body End) -->
        <script src="js/user-display.js"></script>
        <script src="js/user-profile-sidebar.js"></script>
        <script src="js/sidebar-controller.js"></script>

        <!-- App Router (Professional Loader) -->
        <script type="module" src="js/app-router.js"></script>

        <!-- App Initialization -->
        <script type="module">
            import { AppRouter } from './js/app-router.js';

            // Mobile Menu Toggle
            window.toggleMenu = function () {
                document.getElementById('sidebar').classList.toggle('active');
            };

            // Initialize Router
            document.addEventListener('DOMContentLoaded', function () {
                console.log('[App] Inicializando aplicação...');
                AppRouter.init();

                // Load initial page from URL (?page=X) or default to dashboard
                const initialPage = AppRouter.getPageFromURL('dashboard');
                console.log(`[App] Página inicial: ${initialPage}`);
                AppRouter.loadPage(initialPage, false); // Don't update history on initial load
            });

            // Navigation Handler (será expandido na Fase 5)
            document.addEventListener('click', function (e) {
                const link = e.target.closest('[data-page]');
                if (link) {
                    e.preventDefault();
                    const pageName = link.dataset.page;
                    console.log(`[App] Navegação solicitada: ${pageName}`);
                    AppRouter.loadPage(pageName);
                }
            });
        </script>

        <!-- Modal Logout -->
        <div class="modal-logout-overlay" id="modalLogout">
            <div class="modal-logout-content">
                <div class="modal-logout-icon">
                    <i class="fas fa-sign-out-alt"></i>
                </div>

                <h3 class="modal-logout-title">Encerrar Sessão?</h3>
                <p class="modal-logout-text">
                    Sua sessão será encerrada com segurança e seus dados locais serão limpos.
                </p>

                <div class="modal-logout-buttons">
                    <button class="btn-cancel" id="cancelLogout">Cancelar</button>
                    <button class="btn-confirm" id="confirmLogout">Sair Agora</button>
                </div>
            </div>
        </div>
        <!-- Menu Controller (Single Source of Truth) -->
    <script src="js/menu-controller.js"></script>
    
    <!-- Legacy Bridge v2 (Compatibilidade) -->
    <script src="js/legacy-sidebar-bridge-v2.js"></script>
</body>

</html>